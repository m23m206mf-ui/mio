<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å²¡å±±ãƒ»ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹å†…ä¸­å¤å“å–å¼•ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </title>
  <meta name="description" content="å­¦å†…é™å®šã®ä¸­å¤æ•™æãƒ»å‚è€ƒæ›¸ã®å¾ªç’°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯ï¼‰">
  <style>
    :root{
      /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆã‚ˆã‚Šãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ„Ÿã®ã‚ã‚‹ãƒˆãƒ¼ãƒ³ï¼‰ */
      --bg:#f3f4f6;
      --bg-soft:#eef2ff;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#6b7280;
      --primary:#16a34a;
      --primary-soft:#dcfce7;
      --accent:#22c55e;
      --border:#e5e7eb;
      --danger:#ef4444;
      --warning:#f59e0b;
      --info:#3b82f6;
      --nav:#020617;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif;
      color:var(--ink);
      background:radial-gradient(circle at top,#e0f2fe 0,#f3f4f6 45%,#f9fafb 100%);
    }
    a{color:#0ea5e9;text-decoration:none}
    a:hover{text-decoration:underline}
    /* ãƒˆãƒƒãƒ—ãƒŠãƒ“ */
    .nav{
      position:sticky;
      top:0;
      z-index:20;
      backdrop-filter:saturate(160%) blur(10px);
      background:linear-gradient(180deg,rgba(15,23,42,0.98),rgba(15,23,42,0.92));
      border-bottom:1px solid rgba(148,163,184,0.4);
    }
    .nav-inner{
      max-width:1180px;
      margin:auto;
      padding:10px 16px;
      display:flex;
      align-items:center;
      gap:16px;
      color:#e5e7eb;
    }
    .nav-logo{
      font-weight:800;
      font-size:16px;
      letter-spacing:.03em;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .nav-logo-mark{
      width:26px;height:26px;border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#bbf7d0,#22c55e 55%,#15803d 100%);
      display:flex;align-items:center;justify-content:center;
      color:#022c22;font-size:14px;font-weight:900;
      box-shadow:0 0 0 1px rgba(22,163,74,0.4),0 10px 20px rgba(22,163,74,0.45);
    }
    .nav-links{
      display:flex;
      gap:14px;
      font-size:13px;
      margin-left:8px;
      flex:1;
    }
    .nav-links a{
      color:#cbd5f5;
      text-decoration:none;
      position:relative;
      padding-bottom:2px;
    }
    .nav-links a::after{
      content:"";
      position:absolute;
      inset-inline:0;
      bottom:0;
      height:2px;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#22c55e);
      transform:scaleX(0);
      transform-origin:left;
      transition:transform .18s ease-out;
    }
    .nav-links a:hover::after{
      transform:scaleX(1);
    }
    .nav-pill{
      font-size:11px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      color:#e5e7eb;
    }

    header{
      background:linear-gradient(180deg,rgba(15,23,42,0.96),rgba(15,23,42,0.93));
      border-bottom:1px solid rgba(148,163,184,0.4);
      color:#e5e7eb;
    }
    .wrap{max-width:1180px;margin:auto;padding:16px}
    .hero{
      display:grid;
      grid-template-columns:minmax(0,1.6fr) minmax(0,1.2fr);
      gap:18px;
      align-items:center;
      padding:8px 0 12px;
    }
    @media (max-width:800px){
      .hero{grid-template-columns:1fr}
    }
    h1{
      margin:0;
      font-size:clamp(22px,3vw,30px);
      letter-spacing:.02em;
    }
    .sub{
      color:#cbd5f5;
      font-size:13px;
      margin-top:6px;
    }
    .hero-pill-wrap{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .hero-pill{
      font-size:11px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.55);
      background:rgba(15,23,42,0.7);
      display:flex;
      align-items:center;
      gap:6px;
    }
    .hero-pill span.icon{
      width:16px;height:16px;border-radius:999px;
      background:#22c55e;
      display:flex;align-items:center;justify-content:center;
      font-size:11px;color:#022c22;font-weight:700;
    }
    .hero-right{
      background:radial-gradient(circle at top,#22c55e33,#22c55e05 55%,transparent 100%);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.5);
      padding:14px 14px 12px;
      backdrop-filter:blur(10px);
    }
    .hero-right-title{
      font-size:13px;
      font-weight:600;
      margin-bottom:8px;
      color:#e5e7eb;
    }
    .kpi{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .kpi .pill{
      background:rgba(15,23,42,0.92);
      border:1px solid rgba(148,163,184,0.7);
      color:#e5e7eb;
    }

    .toolbar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:12px;
      align-items:center;
    }
    .spacer{flex:1 1 auto}

    input,select,button,textarea{font:inherit}
    .input{
      border:1px solid rgba(148,163,184,0.7);
      border-radius:999px;
      padding:8px 12px;
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      min-width:180px;
      font-size:13px;
    }
    .input::placeholder{color:#9ca3af}
    .input:focus{
      outline:2px solid rgba(34,197,94,0.9);
      outline-offset:1px;
      border-color:transparent;
      background:#020617;
    }

    .btn{
      border:none;
      border-radius:999px;
      padding:9px 14px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition:transform .08s ease-out, box-shadow .12s ease-out, background .12s ease-out;
      white-space:nowrap;
    }
    .btn:active{
      transform:translateY(1px) scale(.99);
      box-shadow:none;
    }
    .btn.primary{
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#022c22;
      box-shadow:0 10px 18px rgba(22,163,74,0.5);
    }
    .btn.primary:hover{
      background:linear-gradient(135deg,#4ade80,#16a34a);
    }
    .btn.ghost{
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.7);
      color:#e5e7eb;
    }
    .btn.ghost:hover{
      background:#020617;
    }
    .btn.warn{
      background:linear-gradient(135deg,#f97316,#ea580c);
      color:#111827;
      box-shadow:0 8px 16px rgba(234,88,12,0.5);
    }
    .btn.info{
      background:linear-gradient(135deg,#38bdf8,#0ea5e9);
      color:#0b1120;
      box-shadow:0 8px 16px rgba(59,130,246,0.5);
    }

    main.wrap{
      margin-top:14px;
      background:rgba(249,250,251,0.98);
      border-radius:24px;
      box-shadow:0 18px 40px rgba(15,23,42,0.10);
      padding:18px 18px 24px;
    }
    .stats-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:10px;
    }
    #stats{
      font-size:13px;
      color:var(--muted);
    }
    .stats-right{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 9px;
      border-radius:999px;
      background:#e5e7eb;
      font-size:12px;
      color:#374151;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:16px;
      margin-top:8px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      position:relative;
      transition:box-shadow .16s ease-out, transform .12s ease-out, border-color .16s ease-out, background .12s ease-out;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:18px;
      background:radial-gradient(circle at top,#bbf7d022,transparent 55%);
      opacity:0;
      transition:opacity .18s ease-out;
      pointer-events:none;
    }
    .card:hover{
      box-shadow:0 16px 36px rgba(15,23,42,0.16);
      transform:translateY(-3px);
      border-color:#bfdbfe;
      background:#f9fafb;
    }
    .card:hover::before{opacity:1}
    .thumb{
      aspect-ratio:4/3;
      background:#f3f4f6;
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      transition:transform .2s ease-out;
    }
    .card:hover .thumb img{
      transform:scale(1.03);
    }
    .body{
      padding:12px 14px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .title{
      font-weight:700;
      font-size:14px;
    }
    .muted{
      color:var(--muted);
      font-size:12px;
    }
    .price{
      font-weight:800;
      color:var(--primary);
      font-size:14px;
    }
    .price del{
      color:#9ca3af;
      font-weight:600;
      margin-left:6px;
      font-size:12px;
    }
    .actions{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border:1px solid var(--border);
      padding:4px 8px;
      border-radius:999px;
      font-size:11px;
      color:var(--muted);
      background:#f9fafb;
    }
    .sold{
      background:#fef2f2;
      border-color:#fecaca;
      color:#b91c1c;
    }

    dialog{
      border:none;
      border-radius:16px;
      width:min(900px,96vw);
      padding:0;
      overflow:hidden;
      box-shadow:0 22px 60px rgba(15,23,42,0.45);
    }
    dialog::backdrop{
      background:rgba(15,23,42,0.65);
      backdrop-filter:blur(4px);
    }
    .modal-head{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#0f172a;
      color:#e5e7eb;
    }
    .modal-body{
      padding:16px;
      background:#ffffff;
      max-height:70vh;
      overflow:auto;
    }
    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:10px;
    }
    .row-1{grid-template-columns:1fr}
    .footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 16px;
      border-top:1px solid var(--border);
      background:#f9fafb;
    }
    .note{
      font-size:12px;
      color:var(--muted);
    }
    .empty{
      border:2px dashed var(--border);
      border-radius:16px;
      padding:28px;
      text-align:center;
      color:var(--muted);
      margin-top:18px;
      background:#f9fafb;
      font-size:13px;
    }
    .help{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }
    .footlinks{
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
      margin-top:6px;
    }
    .section{
      margin-top:8px;
      padding:10px 12px;
      border:1px dashed var(--border);
      border-radius:12px;
      background:#f9fafb;
    }

    /* è¿½åŠ æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç´¹ä»‹ï¼‰ */
    .info-section{
      margin-top:24px;
      display:grid;
      grid-template-columns:minmax(0,1.4fr) minmax(0,1.1fr);
      gap:18px;
      align-items:flex-start;
    }
    @media (max-width:880px){
      .info-section{grid-template-columns:1fr}
    }
    .info-card{
      background:#ffffff;
      border-radius:18px;
      padding:16px 16px 14px;
      border:1px solid var(--border);
    }
    .info-title{
      font-size:15px;
      font-weight:700;
      margin-bottom:6px;
    }
    .info-body{
      font-size:13px;
      color:var(--muted);
      line-height:1.7;
    }
    .steps{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:13px;
      color:var(--muted);
    }
    .step-item{
      display:flex;
      align-items:flex-start;
      gap:8px;
    }
    .step-dot{
      width:18px;height:18px;
      border-radius:999px;
      background:#22c55e;
      color:#022c22;
      display:flex;align-items:center;justify-content:center;
      font-size:11px;font-weight:700;
      flex-shrink:0;
    }
    .highlight-box{
      margin-top:8px;
      padding:8px 10px;
      border-radius:12px;
      background:var(--primary-soft);
      font-size:12px;
      color:#14532d;
    }

    @media (max-width:640px){
      .toolbar{flex-direction:column;align-items:stretch}
      .input{width:100%}
      .nav-inner{flex-wrap:wrap}
      .nav-links{flex-wrap:wrap}
      .stats-row{align-items:flex-start}
      .stats-right{width:100%}
    }
    /* ===== Riverlight Events (polished) ===== */
    .event-wrap{ margin-top:24px; }
    .event-title{ margin:8px 0 0; font-size:20px; letter-spacing:.02em; }
    .event-lead{ margin:10px 0 0; color:var(--muted); font-size:13px; line-height:1.8; }
    .event-badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 12px;border-radius:999px;
      background:linear-gradient(135deg,#22c55e,#0ea5e9);
      color:#0b1120;font-weight:900;font-size:12px;
      box-shadow:0 10px 22px rgba(14,165,233,0.22), 0 10px 22px rgba(34,197,94,0.18);
      width:max-content;
    }
    .event-hero{
      display:grid;
      grid-template-columns:minmax(0,1.45fr) minmax(0,1.05fr);
      gap:16px;
      align-items:start;
      padding:16px;
      border-radius:22px;
      border:1px solid var(--border);
      background:radial-gradient(circle at top,#bbf7d033,transparent 60%), #ffffff;
      box-shadow:0 16px 34px rgba(15,23,42,0.08);
    }
    @media (max-width:920px){ .event-hero{grid-template-columns:1fr} }
    .event-cta-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .event-mini{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .event-countdown{
      margin-top:12px;
      border:1px solid #bfdbfe;
      background:linear-gradient(135deg,#e0f2fe,#f0fdf4);
      border-radius:16px;
      padding:10px 12px;
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .event-countdown-label{ font-weight:800; font-size:12px; color:#0f172a; }
    .event-countdown-time{ font-weight:900; font-size:18px; letter-spacing:.02em; }
    .event-countdown-note{ font-size:12px; color:var(--muted); }

    .event-hero-right{ display:flex; flex-direction:column; gap:12px; }
    .event-poster{
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.5);
      background:linear-gradient(180deg,#0f172a,#020617);
      color:#e5e7eb;
      overflow:hidden;
      box-shadow:0 18px 40px rgba(15,23,42,0.24);
    }
    .event-poster-top{
      display:flex; align-items:center; gap:10px;
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(148,163,184,0.25);
      background:radial-gradient(circle at 20% 0%,rgba(34,197,94,0.35),transparent 55%);
    }
    .event-poster-mark{
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      font-weight:900;color:#0b1120;
      background:linear-gradient(135deg,#22c55e,#38bdf8);
      box-shadow:0 10px 18px rgba(34,197,94,0.25);
    }
    .event-poster-body{ padding:12px; display:flex; flex-direction:column; gap:8px; }
    .event-poster-line{ font-size:13px; color:#e5e7eb; line-height:1.6; }
    .event-poster-foot{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:10px 12px 12px;
      border-top:1px solid rgba(148,163,184,0.25);
    }
    .event-rsvp-mini{
      background:#ffffff;
      border-radius:18px;
      border:1px solid var(--border);
      padding:12px;
    }
    .event-rsvp-mini-title{ font-weight:800; font-size:13px; margin-bottom:4px; }

    .event-grid{
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(3, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width:920px){ .event-grid{grid-template-columns:1fr} }
    .event-card{
      border:1px solid var(--border);
      border-radius:18px;
      background:#ffffff;
      padding:12px;
      box-shadow:0 14px 28px rgba(15,23,42,0.06);
    }
    .event-card-head{ display:flex; gap:10px; align-items:flex-start; }
    .event-icon{
      width:38px;height:38px;border-radius:14px;
      display:grid;place-items:center;
      background:var(--bg-soft);
      border:1px solid rgba(191,219,254,0.8);
      font-size:18px;
      flex-shrink:0;
    }
    .event-card-title{ font-weight:900; font-size:14px; }
    .event-card-body{ margin-top:10px; }
    .event-kv{ display:flex; gap:8px; flex-wrap:wrap; }
    .event-card-note{ margin-top:8px; font-size:12px; color:var(--muted); }
    .event-split{
      margin-top:14px;
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
      gap:12px;
    }
    @media (max-width:920px){ .event-split{grid-template-columns:1fr} }

    .event-faq{
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      background:#f9fafb;
      margin-top:8px;
    }
    .event-faq summary{
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      color:#0f172a;
      list-style:none;
    }
    .event-faq summary::-webkit-details-marker{display:none}
    .event-faq-body{ margin-top:8px; font-size:13px; color:var(--muted); line-height:1.7; }


    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    footer{
      padding:20px;
      text-align:center;
      font-size:12px;
      color:#6b7280;
      border-top:1px solid #e5e7eb;
      background:#f9fafb;
      margin-top:22px;
    }
  </style>
</head>
<body>
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="nav">
    <div class="nav-inner">
      <div class="nav-logo">
        <div class="nav-logo-mark">Re</div>
        <span>Campus Reuse Books</span>
      </div>
      <div class="nav-links">
        <a href="#market">ãƒãƒ¼ã‚±ãƒƒãƒˆ</a>
        <a href="#about">ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦</a>
        <a href="#events">ã‚¤ãƒ™ãƒ³ãƒˆ</a>
        <a href="#tosSection">åˆ©ç”¨è¦ç´„</a>
      </div>
      <div class="nav-pill">å­¦å†…é™å®šãƒ»éå–¶åˆ©ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</div>
    </div>
  </div>

  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¨ãƒªã‚¢ + ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
  <header id="top">
    <div class="wrap">
      <div class="hero">
        <div>
          <h1>å²¡å±±ãƒ»ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹å†…ä¸­å¤å“å–å¼•ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </h1>
          <div class="sub">
            æ•™æãƒ»å‚è€ƒæ›¸ãƒ»æ–‡æˆ¿å…·ãƒ»å°å‹å®¶å…·ãªã©ã‚’ã€<br>
            <strong>ã€ŒåŒã˜ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã®å…ˆè¼©ãƒ»å¾Œè¼©ã©ã†ã—ã€ã§å¾ªç’°ã•ã›ã‚‹</strong>ãŸã‚ã®å®Ÿé¨“çš„ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
            ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã€å­¦å†…ã®å°ã•ãªçµŒæ¸ˆåœã¥ãã‚Šã‚’ç›®æŒ‡ã—ã¾ã™ã€‚
          </div>
          <div class="hero-pill-wrap">
            <div class="hero-pill"><span class="icon">â‘ </span>å­¦å†…é™å®šãƒ»é¡”ã®è¦‹ãˆã‚‹å–å¼•</div>
            <div class="hero-pill"><span class="icon">â‘¡</span>ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã§ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚åˆ©ç”¨å¯</div>
            <div class="hero-pill"><span class="icon">â‘¢</span>ã‚¯ãƒ¼ãƒãƒ³ãƒ»ç›¸å ´æ©Ÿèƒ½ä»˜ãã§ä¾¡æ ¼ã‚‚è¦‹ãˆã‚‹åŒ–</div>
          </div>
        </div>
        <div class="hero-right">
          <div class="hero-right-title">ã„ã¾ã®ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã®ã€Œå¾ªç’°ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ</div>
          <div class="kpi" id="kpi"></div>
          <div class="help">
            â€» ã“ã®æ•°å­—ã¯ã€ã‚ãªãŸã®ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å‡ºå“ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã—ãŸãƒ­ãƒ¼ã‚«ãƒ«çµ±è¨ˆã§ã™ã€‚<br>
            å®Ÿéš›ã®ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹å…¨ä½“ã®æµé€šé‡ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚
          </div>
        </div>
      </div>

      <div class="toolbar">
        <input id="q" class="input" placeholder="æ›¸åãƒ»è‘—è€…ã‚’æ¤œç´¢" />
        <select id="cat" class="input">
          <option value="">ã‚«ãƒ†ã‚´ãƒªï¼ˆã™ã¹ã¦ï¼‰</option>
          <option>æ•™ç§‘æ›¸</option>
          <option>å°‚é–€æ›¸</option>
          <option>å‚è€ƒæ›¸</option>
          <option>èªå­¦</option>
          <option>å°èª¬</option>
        </select>
        <select id="cond" class="input">
          <option value="">çŠ¶æ…‹ï¼ˆã™ã¹ã¦ï¼‰</option>
          <option>æ–°å“åŒæ§˜</option>
          <option>è‰¯ã„</option>
          <option>å¯</option>
        </select>
        <select id="pickup" class="input">
          <option value="">å—ã‘æ¸¡ã—å ´æ‰€ï¼ˆã™ã¹ã¦ï¼‰</option>
        </select>
        <select id="sort" class="input">
          <option value="new">æ–°ç€é †</option>
          <option value="price_asc">ä¾¡æ ¼ãŒå®‰ã„é †</option>
          <option value="price_desc">ä¾¡æ ¼ãŒé«˜ã„é †</option>
        </select>
        <button id="addBtn" class="btn primary">ï¼‹ å‡ºå“ã™ã‚‹</button>
        <button id="couponBtn" class="btn ghost" title="ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨/ç®¡ç†">ã‚¯ãƒ¼ãƒãƒ³</button>
        <button id="exportBtn" class="btn ghost">ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãå‡ºã™</button>
        <label class="btn ghost" for="importFile">èª­ã¿è¾¼ã¿</label>
        <input id="importFile" type="file" accept="application/json" style="display:none"/>
        <button id="buybackBtn" class="btn.warn" title="å‚è€ƒè²·å–ä¾¡æ ¼ã‚’æ¤œç´¢">è²·å–ä¾¡æ ¼ã‚’æ¤œç´¢</button>
        <span class="spacer"></span>
        <button id="bizBtn" class="btn info" title="äº‹æ¥­è€…ãƒ»æ³•ä»¤æƒ…å ±">äº‹æ¥­è€…è¨­å®š</button>
        <a href="javascript:void(0)" id="openTos" style="font-size:12px;color:#e5e7eb;">åˆ©ç”¨è¦ç´„</a>
      </div>
    </div>
  </header>

  <!-- ãƒãƒ¼ã‚±ãƒƒãƒˆæœ¬ä½“ -->
  <main class="wrap" id="market">
    <div class="stats-row">
      <div id="stats" class="muted"></div>
      <div class="stats-right">
        <span class="pill">ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ</span>
        <span class="pill">ä¾¡æ ¼ææ¡ˆãƒ»è²·å–ç›®å®‰ã¤ã</span>
      </div>
    </div>

    <div id="list" class="grid"></div>
    <div id="empty" class="empty" hidden>ã¾ã å‡ºå“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œï¼‹ å‡ºå“ã™ã‚‹ã€ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>

    <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="info-section" id="about">
      <div class="info-card">
        <div class="info-title">ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦</div>
        <div class="info-body">
          æœ¬ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ã€å²¡å±±ã®ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹å†…ã§çœ ã£ã¦ã„ã‚‹æ•™ç§‘æ›¸ãƒ»å‚è€ƒæ›¸ãƒ»æ–‡æˆ¿å…·ãƒ»å°å‹å®¶å…·ãªã©ã‚’ã€
          <strong>ã€Œæ¨ã¦ã‚‹å‰ã«ã€ã¾ãšã¯å¾Œè¼©ã¸ãƒãƒˆãƒ³ã‚’æ¸¡ã™ã€</strong>ã¨ã„ã†ç™ºæƒ³ã§å¾ªç’°ã•ã›ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ãŸå­¦å†…å‘ã‘ã®å®Ÿé¨“çš„ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚<br><br>
          å–å¼•ãƒ‡ãƒ¼ã‚¿ã¯ã‚ãã¾ã§ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒã«ã¯ä¸€åˆ‡é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚
          ãã®ãŸã‚ã€<strong>å­¦å†…ã®å°ã•ãªã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ãªãƒãƒ¼ã‚±ãƒƒãƒˆ</strong>ã¨ã—ã¦ã€æˆæ¥­ã®ä¸€ç’°ã‚„ã‚µãƒ¼ã‚¯ãƒ«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚‚å®‰å¿ƒã—ã¦è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
          ä»Šå¾Œã¯ã€å®Ÿéš›ã«å¤ç‰©å•†è¨±å¯ã‚’å–å¾—ã—ãŸå›£ä½“ã‚„å¤§å­¦å…¬å¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨é€£æºã—ãªãŒã‚‰ã€ã‚ˆã‚Šå®‰å…¨ãªé‹å–¶å½¢æ…‹ã¸ç™ºå±•ã•ã›ã¦ã„ãã“ã¨ã‚‚æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
        </div>
        <div class="highlight-box">
          ã‚¢ã‚¤ãƒ‡ã‚¢ä¾‹ï¼šå¹´é–“ã®æ•™ç§‘æ›¸ãƒ»å‚è€ƒæ›¸è³¼å…¥é¡ã®ä¸€éƒ¨ã‚’ã€Œå­¦å†…ãƒªãƒ¦ãƒ¼ã‚¹ã€ã§å›ã™ã“ã¨ã§ã€<br>
          å­¦ç”Ÿã®è² æ‹…è»½æ¸›ãƒ»å»ƒæ£„ç‰©å‰Šæ¸›ãƒ»ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æ´»æ€§åŒ–ã‚’åŒæ™‚ã«ç›®æŒ‡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
        </div>
      </div>

      <div class="info-card">
        <div class="info-title">ä½¿ã„æ–¹ï¼ˆå­¦ç”Ÿå‘ã‘ãƒ»3ã‚¹ãƒ†ãƒƒãƒ—ï¼‰</div>
        <div class="steps">
          <div class="step-item">
            <div class="step-dot">1</div>
            <div>
              <strong>ã„ã‚‰ãªããªã£ãŸæ•™æã‚’ç™»éŒ²</strong><br>
              ã€Œï¼‹ å‡ºå“ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ã€æ›¸åãƒ»çŠ¶æ…‹ãƒ»å—ã‘æ¸¡ã—å ´æ‰€ãƒ»å¸Œæœ›ä¾¡æ ¼ãªã©ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
              ç”»åƒURLã‚’è²¼ã‚‹ã‹ã€Œç”»åƒã‚’è‡ªå‹•ç”Ÿæˆã€ã§ã‚«ãƒãƒ¼ç”»åƒã‚‚ä½œæˆã§ãã¾ã™ã€‚
            </div>
          </div>
          <div class="step-item">
            <div class="step-dot">2</div>
            <div>
              <strong>æ¤œç´¢ãƒ»çµã‚Šè¾¼ã¿ã§æ¢ã™</strong><br>
              ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ»çŠ¶æ…‹ãƒ»å—ã‘æ¸¡ã—å ´æ‰€ãƒ»ä¾¡æ ¼é †ã‚½ãƒ¼ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã€æ¬²ã—ã„æ•™æã‚’æ¢ã—ã¾ã™ã€‚
              å‡ºå“ã‚«ãƒ¼ãƒ‰ã‹ã‚‰å‡ºå“è€…ã®é€£çµ¡å…ˆã‚’ç¢ºèªã—ã€DMã‚„ãƒ¡ãƒ¼ãƒ«ãªã©ã§å€‹åˆ¥ã«ã‚„ã‚Šã¨ã‚Šã—ã¾ã™ã€‚
            </div>
          </div>
          <div class="step-item">
            <div class="step-dot">3</div>
            <div>
              <strong>å¯¾é¢ã§å—ã‘æ¸¡ã—ãƒ»ç²¾ç®—</strong><br>
              å›³æ›¸é¤¨å‰ã‚„å­¦ç”Ÿä¼šé¤¨ãªã©äº‹å‰ã«æ±ºã‚ãŸå ´æ‰€ãƒ»æ™‚é–“ã§å¯¾é¢å—ã‘æ¸¡ã—ã‚’è¡Œã„ã€ç¾é‡‘ã¾ãŸã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹ã§æ”¯æ‰•ã„ã‚’ã—ã¾ã™ã€‚
              å–å¼•å®Œäº†å¾Œã¯ã€ã‚«ãƒ¼ãƒ‰ã®ã€ŒSOLDã«ã™ã‚‹ã€ã€Œæ”¯æ‰•ã„æ¸ˆã¿ã«ã™ã‚‹ã€ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã‚‚ã§ãã¾ã™ã€‚
            </div>
          </div>
        </div>
      </div>
    </section>


    
    <!-- Riverlight ã‚¤ãƒ™ãƒ³ãƒˆ -->
    <section id="events" class="event-wrap" aria-label="Riverlight ã‚¤ãƒ™ãƒ³ãƒˆ">
      <div class="event-hero">
        <div class="event-hero-left">
          <div class="event-badge">Riverlight</div>
          <h2 class="event-title">ç‰©ã¨çŸ¥è­˜ã®ä¾¡å€¤ã‚’ä¼ãˆã‚‹ã€å­¦å†…ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
          <p class="event-lead">
            ã€Œå¤§å­¦ã¯å·ã®ã‚ˆã†ã«å­¦ç”Ÿã‚’è‚²ã¦ã¦æµã™ã€‚ç§ãŸã¡å­¦ç”Ÿã¯å·ã®æ³¢ã¨ã—ã¦æµ·ã¸å‘ã‹ã†ã€â€”â€”
            ã“ã®æ´»å‹•ãŒå°ã•ãªç¯ã‚Šã¨ãªã‚Šã€æœ¬ãƒ»çŸ¥è­˜ã®ä¾¡å€¤ã‚’ä¼ãˆç¶šã‘ã¾ã™ã€‚
          </p>

          <div class="event-cta-row">
            <button class="btn primary" type="button" id="eventRsvpBtn">å‚åŠ ã™ã‚‹ï¼ˆè¨˜éŒ²ï¼‰</button>
            <a class="btn ghost" href="#eventHow">å‚åŠ æ–¹æ³•</a>
            <a class="btn ghost" href="#eventRules">æ³¨æ„äº‹é …</a>
          </div>

          <div class="event-countdown" id="eventCountdown" hidden>
            <div class="event-countdown-label">é–‹å‚¬ã¾ã§</div>
            <div class="event-countdown-time" id="eventCountdownTime">--</div>
            <div class="event-countdown-note" id="eventCountdownNote"></div>
          </div>

          <div class="event-mini">
            <div class="pill">å­¦å†…é–‹å‚¬</div>
            <div class="pill">æœ¬ Ã— äº¤æµ Ã— ãƒªãƒ¦ãƒ¼ã‚¹</div>
            <div class="pill">å…ˆç€ç‰¹å…¸ã‚ã‚Š</div>
          </div>

          <div class="highlight-box" style="margin-top:10px">
            ç›®æ¨™ï¼šã‚¤ãƒ™ãƒ³ãƒˆã‚’ãã£ã‹ã‘ã«ã€å­¦å†…ãƒªãƒ¦ãƒ¼ã‚¹ã®ä»•çµ„ã¿ï¼ˆå›åãƒ»æ¤œå“ãƒ»ä¾¡æ ¼ã®è¦‹ãˆã‚‹åŒ–ï¼‰ã‚’è‚²ã¦ã¦ã„ã
          </div>
        </div>

        <div class="event-hero-right">
          <div class="event-poster">
            <div class="event-poster-top">
              <div class="event-poster-mark">RL</div>
              <div>
                <div style="font-weight:800">Riverlight</div>
                <div class="muted" style="margin-top:2px">ä¾¡å€¤ã‚’ä¼ãˆã‚ˆã†ï¼</div>
              </div>
            </div>
            <div class="event-poster-body">
              <div class="event-poster-line"><strong>â‘  èª­æ›¸ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹</strong>ï¼ˆÂ¥1,000 / 3å†Šï¼‰</div>
              <div class="event-poster-line"><strong>â‘¡ ãƒ–ãƒƒã‚¯ã‚¹ãƒ¯ãƒƒãƒ—</strong>ï¼ˆ1å†ŠæŒå‚ã§äº¤æ›ï¼‰</div>
              <div class="event-poster-line"><strong>ç‰¹å…¸</strong>ï¼šä¸­å›½é¢¨ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆå…ˆç€200åï¼‰</div>
            </div>
            <div class="event-poster-foot">
              <span class="badge">ä¼šå ´ã§ç›´æ¥å‚åŠ </span>
              <span class="badge">ãƒ©ãƒ³ãƒ€ãƒ ã§å‡ºä¼šã†</span>
            </div>
          </div>

          <div class="event-rsvp-mini">
            <div class="event-rsvp-mini-title">ã‚ãªãŸã®å‚åŠ ãƒ¡ãƒ¢ï¼ˆã“ã®ç«¯æœ«ï¼‰</div>
            
            <div class="event-auth-row" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:6px 0 2px">
              <span class="muted" id="authStatus">æœªãƒ­ã‚°ã‚¤ãƒ³</span>
              <button class="btn ghost" type="button" id="openAuthBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
              <button class="btn ghost" type="button" id="logoutBtn" style="display:none">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
            <div class="help" style="margin-top:4px">â€» ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ãƒ»URLã”ã¨ã«ä¿å­˜ã•ã‚Œã¾ã™</div>
<div class="muted" id="eventRsvpStatus">æœªç™»éŒ²</div>
            <div class="help" style="margin-top:6px">â€» ã‚¯ãƒªãƒƒã‚¯ã§ç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ã«å‚åŠ è¨˜éŒ²ï¼ˆåå‰ãªã—ï¼‰ã‚’ä¿å­˜ã—ã¾ã™ã€‚</div>
          </div>
        </div>
      </div>

      <div class="event-grid">
        <article class="event-card">
          <div class="event-card-head">
            <div class="event-icon">ğŸ“¦</div>
            <div>
              <div class="event-card-title">èª­æ›¸ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹</div>
              <div class="muted">ãƒ©ãƒ³ãƒ€ãƒ ã«æœ¬3å†Šã€‚æ™®æ®µèª­ã¾ãªã„ã‚¸ãƒ£ãƒ³ãƒ«ã¨ã®å‡ºä¼šã„ã€‚</div>
            </div>
          </div>
          <div class="event-card-body">
            <div class="event-kv">
              <span class="pill">ä¾¡æ ¼ï¼šÂ¥1,000</span>
              <span class="pill">å†…å®¹ï¼šæœ¬3å†Š</span>
              <span class="pill">è³¼å…¥ï¼šä¼šå ´ã§ç›´æ¥</span>
            </div>
            <div class="event-card-note">â€» ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã®æ€§è³ªä¸Šã€è¿”å“ä¸å¯ã€‚</div>
          </div>
        </article>

        <article class="event-card">
          <div class="event-card-head">
            <div class="event-icon">ğŸ”</div>
            <div>
              <div class="event-card-title">ãƒ–ãƒƒã‚¯ã‚¹ãƒ¯ãƒƒãƒ—</div>
              <div class="muted">1å†ŠæŒå‚ â†’ ãƒ©ãƒ³ãƒ€ãƒ äº¤æ›ã€‚æ°—è»½ã«äº¤æµã§ãã‚‹ä¼ç”»ã€‚</div>
            </div>
          </div>
          <div class="event-card-body">
            <div class="event-kv">
              <span class="pill">æ¡ä»¶ï¼šæœ¬1å†ŠæŒå‚</span>
              <span class="pill">ãƒ«ãƒ¼ãƒ«ï¼šä¸€äºº1å†Š</span>
              <span class="pill">æ–¹å¼ï¼šãƒ©ãƒ³ãƒ€ãƒ äº¤æ›</span>
            </div>
            <div class="event-card-note">â€» äº¤æ›æœ¬ã¯çŠ¶æ…‹è‰¯å¥½ã®ã‚‚ã®ã«é™ã‚Šã¾ã™ã€‚</div>
          </div>
        </article>

        <article class="event-card">
          <div class="event-card-head">
            <div class="event-icon">ğŸ</div>
            <div>
              <div class="event-card-title">å…ˆç€ç‰¹å…¸ï¼ˆ200åï¼‰</div>
              <div class="muted">ã‚ªãƒªã‚¸ãƒŠãƒ«ä¸­å›½é¢¨ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã€‚</div>
            </div>
          </div>
          <div class="event-card-body">
            <div class="event-kv">
              <span class="pill">ç‰¹å…¸ï¼šãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</span>
              <span class="pill">å…ˆç€ï¼š200å</span>
              <span class="pill">å—å–ï¼šä¼šå ´</span>
            </div>
            <div class="event-card-note">â€» æ•°é‡ã«é”ã—æ¬¡ç¬¬çµ‚äº†ã€‚</div>
          </div>
        </article>
      </div>

      <div class="event-split" id="eventHow">
        <div class="info-card">
          <div class="info-title">å‚åŠ æ–¹æ³•ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</div>
          <div class="steps">
            <div class="step-item"><div class="step-dot">1</div><div><strong>ä¼šå ´ã¸æ¥ã‚‹</strong><br>å½“æ—¥ã¯å­¦å†…ã®ä¼šå ´ã§ç›´æ¥å‚åŠ ã§ãã¾ã™ã€‚</div></div>
            <div class="step-item"><div class="step-dot">2</div><div><strong>ä¼ç”»ã‚’é¸ã¶</strong><br>ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹è³¼å…¥ or ãƒ–ãƒƒã‚¯ã‚¹ãƒ¯ãƒƒãƒ—å‚åŠ ã€‚</div></div>
            <div class="step-item"><div class="step-dot">3</div><div><strong>æ–°ã—ã„æœ¬ã¨å‡ºä¼šã†</strong><br>ã€Œãƒ©ãƒ³ãƒ€ãƒ ã€ã‚’æ¥½ã—ã‚€ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚</div></div>
          </div>
          <div class="help">â€» é–‹å‚¬æ—¥æ™‚ãƒ»å ´æ‰€ã¯æ±ºã¾ã‚Šæ¬¡ç¬¬ã€SNSï¼ã‚µã‚¤ãƒˆã§å‘ŠçŸ¥ã—ã¾ã™ã€‚</div>
        </div>

        <div class="info-card" id="eventRules">
          <div class="info-title">æ³¨æ„äº‹é …ï¼ˆãƒˆãƒ©ãƒ–ãƒ«é˜²æ­¢ï¼‰</div>
          <details class="event-faq" open>
            <summary>ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã¯è¿”å“ã§ãã¾ã™ã‹ï¼Ÿ</summary>
            <div class="event-faq-body">ã§ãã¾ã›ã‚“ï¼ˆãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã®æ€§è³ªä¸Šã€è¿”å“ä¸å¯ï¼‰ã€‚</div>
          </details>
          <details class="event-faq">
            <summary>äº¤æ›ã«æŒã£ã¦ã„ãæœ¬ã®æ¡ä»¶ã¯ï¼Ÿ</summary>
            <div class="event-faq-body">çŠ¶æ…‹è‰¯å¥½ã®ã‚‚ã®ã«é™ã‚Šã¾ã™ã€‚æ¼«ç”»ã‚„æ•™ç§‘æ›¸ãªã©ã®ç¨®é¡ã¯äº¤æ›ä¸å¯ã¨ã—ã¾ã™ã€‚</div>
          </details>
          <details class="event-faq">
            <summary>ç‰¹å…¸ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¯èª°ã§ã‚‚ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ</summary>
            <div class="event-faq-body">å…ˆç€200åæ§˜é™å®šã§ã™ã€‚æ•°é‡ã«é”ã—æ¬¡ç¬¬çµ‚äº†ã—ã¾ã™ã€‚</div>
          </details>
          <details class="event-faq">
            <summary>ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ã­ã‚‰ã„ã¯ï¼Ÿ</summary>
            <div class="event-faq-body">æœ¬ãƒ»çŸ¥è­˜ã®ä¾¡å€¤ã‚’å†ç™ºè¦‹ã—ã€å°†æ¥ã®å­¦å†…ãƒªãƒ¦ãƒ¼ã‚¹é‹å–¶ï¼ˆå›åãƒ»æ¤œå“ãƒ»ä¾¡æ ¼ã®è¦‹ãˆã‚‹åŒ–ï¼‰ã«ã¤ãªã’ã¾ã™ã€‚</div>
          </details>
        </div>
      </div>

      <div class="info-card" style="margin-top:14px">
        <div class="info-title">ã‚¤ãƒ™ãƒ³ãƒˆå¾Œã®å±•æœ›</div>
        <div class="info-body">
          ä»Šå­¦æœŸã®ã‚¤ãƒ™ãƒ³ãƒˆãŒçµ‚ã‚ã£ãŸå¾Œã‚‚ã€ã‚µã‚¤ãƒˆã®æ©Ÿèƒ½ã‚’ã•ã‚‰ã«æ”¹å–„ã—ã¦ã„ãã¾ã™ã€‚
          èª­æ›¸ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã®ä¼ç”»ã¯ä»Šå¾Œã‚‚ç¶šã‘ã€ä½ä¾¡æ ¼ã§æ™®æ®µèª­ã¾ãªã„æœ¬ã«å‡ºä¼šãˆã‚‹æ©Ÿä¼šã‚’å¢—ã‚„ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
          ã¾ãŸã€ã‚¤ãƒ™ãƒ³ãƒˆã‚„ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’é€šã—ã¦ä¸­å›½æ–‡åŒ–ã«ã‚‚è§¦ã‚Œã¦ã‚‚ã‚‰ã„ã€å­¦å†…ã®äº¤æµã‚’åºƒã’ã¦ã„ãã¾ã™ã€‚
        </div>
        <div class="highlight-box">
          ç™ºä¿¡æ‹ ç‚¹ï¼š<strong>riverlightvlp.com</strong>ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—æ¸ˆã¿ï¼‰
        </div>
      </div>
    </section>
</main>

  <!-- å‡ºå“ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog id="modal">
    <form method="dialog">
      <div class="modal-head">
        <strong id="modalTitle">å‡ºå“ã‚’ä½œæˆ</strong>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div>
            <label>æ›¸å<br><input id="f_title" class="input" required></label>
          </div>
          <div>
            <label>è‘—è€…<br><input id="f_author" class="input"></label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>ã‚«ãƒ†ã‚´ãƒª<br>
              <select id="f_cat" class="input" required>
                <option>æ•™ç§‘æ›¸</option><option>å°‚é–€æ›¸</option><option>å‚è€ƒæ›¸</option><option>èªå­¦</option><option>å°èª¬</option>
              </select>
            </label>
          </div>
          <div>
            <label>çŠ¶æ…‹<br>
              <select id="f_cond" class="input" required>
                <option>æ–°å“åŒæ§˜</option><option selected>è‰¯ã„</option><option>å¯</option>
              </select>
            </label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>ä¾¡æ ¼ï¼ˆå††ï¼‰<br>
              <div style="display:flex; gap:8px; align-items:center;">
                <input id="f_price" type="number" min="0" step="1" class="input" required>
                <button id="suggestBtn" type="button" class="btn ghost" title="ç›¸å ´ã‹ã‚‰è‡ªå‹•è¨ˆç®—">ä¾¡æ ¼ã‚’ææ¡ˆ</button>
              </div>
              <div id="suggestInfo" class="help"></div>
            </label>
          </div>
          <div>
            <label>ç”»åƒURLï¼ˆä»»æ„ï¼‰<br>
              <div style="display:flex; gap:8px; align-items:center;">
                <input id="f_img" class="input" placeholder="https://...">
                <button id="genCoverBtn" type="button" class="btn ghost" title="ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ç”Ÿæˆ">ç”»åƒã‚’è‡ªå‹•ç”Ÿæˆ</button>
              </div>
              <div class="help">â€» URL ã‚’è²¼ã‚‹ã‹ã€ã€Œç”»åƒã‚’è‡ªå‹•ç”Ÿæˆã€ã§ã‚«ãƒãƒ¼ç”»åƒï¼ˆSVGï¼‰ã‚’ä½œæˆã—ã¾ã™</div>
            </label>
          </div>
        </div>
        <!-- æ”¯æ‰•æƒ…å ± -->
        <div class="row">
          <div>
            <label>æ”¯æ‰•æ–¹æ³•<br>
              <select id="f_payMethod" class="input">
                <option value="">æœªæŒ‡å®š</option>
                <option>å¯¾é¢ç¾é‡‘</option>
                <option>PayPay</option>
                <option>éŠ€è¡ŒæŒ¯è¾¼</option>
              </select>
            </label>
          </div>
          <div>
            <label>æ±ºæ¸ˆãƒªãƒ³ã‚¯ï¼ˆä»»æ„ï¼‰<br>
              <input id="f_payLink" class="input" placeholder="ä¾‹ï¼šhttps://paypayãƒªãƒ³ã‚¯ ã‚„ æŒ¯è¾¼æ¡ˆå†…ãƒšãƒ¼ã‚¸">
            </label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>å—ã‘æ¸¡ã—å ´æ‰€<br><input id="f_pickup" class="input" placeholder="ä¾‹ï¼šå›³æ›¸é¤¨å‰"></label>
          </div>
          <div>
            <label>ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰<br><input id="f_coupon" class="input" placeholder="ä¾‹ï¼šWELCOME10"></label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>å‡ºå“è€…åï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å¯ï¼‰<br><input id="f_seller" class="input"></label>
          </div>
          <div>
            <label>é€£çµ¡å…ˆï¼ˆãƒ¡ãƒ¼ãƒ« / SNS / å­¦å†…IDï¼‰<br><input id="f_contact" class="input"></label>
          </div>
        </div>
        <div class="row row-1">
          <label>èª¬æ˜ï¼ˆä»»æ„ï¼‰<br><textarea id="f_desc" class="input" rows="4" placeholder="æ›¸ãè¾¼ã¿æœ‰ç„¡ã€ç‰ˆã€å—ã‘æ¸¡ã—æ™‚é–“å¸¯ãªã©"></textarea></label>
        </div>
        <div class="help">â€» ä¿å­˜å…ˆï¼šã“ã®ç«¯æœ«ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</div>
      </div>
      <div class="footer">
        <div style="display:flex;gap:8px">
          <button id="delBtn" class="btn" style="display:none;background:var(--danger);color:#fff">å‰Šé™¤</button>
          <button class="btn primary" id="saveBtn">ä¿å­˜</button>
        </div>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
    </form>
  </dialog>

  <!-- ã‚¯ãƒ¼ãƒãƒ³ç®¡ç† -->
  <dialog id="coupon">
    <form method="dialog">
      <div class="modal-head">
        <strong>ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ï¼ç®¡ç†</strong>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div>
            <label>ã‚³ãƒ¼ãƒ‰<br><input id="cp_code" class="input" placeholder="WELCOME10"></label>
          </div>
          <div>
            <label>å€¤å¼•ã‚¿ã‚¤ãƒ—<br>
              <select id="cp_type" class="input">
                <option value="pct">å‰²åˆï¼ˆ%OFFï¼‰</option>
                <option value="amt">é‡‘é¡ï¼ˆå††OFFï¼‰</option>
              </select>
            </label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>å€¤å¼•å€¤ï¼ˆ%ã¾ãŸã¯å††ï¼‰<br><input id="cp_value" class="input" type="number" min="1" step="1" placeholder="10"></label>
          </div>
          <div>
            <label>æœ€å°æ³¨æ–‡é‡‘é¡ï¼ˆä»»æ„ï¼‰<br><input id="cp_min" class="input" type="number" min="0" step="1" placeholder="0"></label>
          </div>
        </div>
        <div class="row">
          <div>
            <label>é©ç”¨ã‚«ãƒ†ã‚´ãƒªï¼ˆç©ºã§å…¨ä½“ï¼‰<br><input id="cp_cat" class="input" placeholder="æ•™ç§‘æ›¸,èªå­¦"></label>
          </div>
          <div>
            <label>æœ‰åŠ¹æœŸé™ï¼ˆä»»æ„ï¼‰<br><input id="cp_until" class="input" type="date"></label>
          </div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
          <button id="cp_add" class="btn primary" type="button">è¿½åŠ /æ›´æ–°</button>
          <button id="cp_clear" class="btn ghost" type="button">å…¨ã‚¯ãƒ¼ãƒãƒ³å‰Šé™¤</button>
        </div>
        <div id="cp_list" class="help" style="margin-top:10px"></div>
        <div class="help">â€» PPTã§è§¦ã‚Œã‚‰ã‚Œã¦ã„ã‚‹ã€Œã‚¯ãƒ¼ãƒãƒ³å°å…¥ã€æ§‹æƒ³ã‚’åæ˜ ã€‚AIä¾¡æ ¼æ¨å¥¨ã¨ä½µç”¨å¯ã€‚</div>
      </div>
      <div class="footer">
        <span class="note">ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯</span>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
    </form>
  </dialog>

  <!-- å‚è€ƒè²·å–ä¾¡æ ¼æ¤œç´¢ -->
  <dialog id="buyback">
    <form method="dialog">
      <div class="modal-head">
        <strong>å‚è€ƒè²·å–ä¾¡æ ¼ï¼ˆç›®å®‰ï¼‰ã‚’æ¤œç´¢</strong>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div>
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆæ›¸å / è‘—è€… / ISBNï¼‰<br>
              <input id="bb_query" class="input" placeholder="ä¾‹ï¼šPython å®Ÿè·µ / 978...">
            </label>
          </div>
          <div>
            <label>çŠ¶æ…‹<br>
              <select id="bb_cond" class="input">
                <option selected>è‰¯ã„</option>
                <option>æ–°å“åŒæ§˜</option>
                <option>å¯</option>
              </select>
            </label>
          </div>
        </div>
        <div class="row row-1">
          <div>
            <button id="bb_calc" class="btn primary" type="button">è²·å–ä¾¡æ ¼ã‚’è¨ˆç®—</button>
            <label class="btn ghost" for="buybackFile" title="å‚è€ƒå®šä¾¡ãƒ‡ãƒ¼ã‚¿(JSON)ã‚’èª­ã¿è¾¼ã¿">å‚è€ƒãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</label>
            <input id="buybackFile" type="file" accept="application/json" style="display:none">
          </div>
        </div>
        <div id="bb_result" class="help" style="margin-top:10px"></div>
        <div class="help">â€» è¨ˆç®—æ–¹æ³•ï¼šæ²è¼‰ä¸­å¤®å€¤ or å‚è€ƒå®šä¾¡ Ã— çŠ¶æ…‹ä¿‚æ•°ã€‚ä¿è¨¼å€¤ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
      </div>
      <div class="footer">
        <span class="note">ãƒ­ãƒ¼ã‚«ãƒ«ã§è¨ˆç®—ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯ï¼‰</span>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
    </form>
  </dialog>

  <!-- åˆ©ç”¨è¦ç´„ï¼ˆä¿æŒï¼‰ -->
  <dialog id="tos">
    <form method="dialog">
      <div class="modal-head">
        <strong>åˆ©ç”¨è¦ç´„ï¼ˆå­¦å†…ãƒ»éå–¶åˆ©ã®é››å½¢ï¼‰</strong>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
      <div class="modal-body" id="tosSection">
        <ol style="padding-left:18px;line-height:1.7;font-size:13px;">
          <li>æœ¬ã‚µã‚¤ãƒˆã¯å­¦å†…é™å®šã®è©¦é¨“é‹ç”¨ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã‚ã‚Šã€å•†ç”¨åˆ©ç”¨ã‚’ç¦æ­¢ã—ã¾ã™ã€‚</li>
          <li>ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚å‰Šé™¤ãƒ»ç«¯æœ«å¤‰æ›´ã§å¤±ã‚ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
          <li>å‡ºå“ã¯çœŸå®Ÿãƒ»æ­£ç¢ºã‚’å¿ƒæ›ã‘ã€æ¨©åˆ©ä¾µå®³ãƒ»é•æ³•ç‰©å“ã®æ²è¼‰ã¯ç¦æ­¢ã—ã¾ã™ã€‚</li>
          <li>ä¾¡æ ¼ææ¡ˆãƒ»è²·å–ç›®å®‰ã¯å‚è€ƒå€¤ã§ã€å®Ÿä¾¡æ ¼ã®ä¿è¨¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
          <li>å–å¼•ã¯å½“äº‹è€…ã®è‡ªå·±è²¬ä»»ã¨ã—ã€é‹å–¶ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ï¼ˆæ•…æ„ãƒ»é‡éå¤±ã‚’é™¤ãï¼‰ã€‚</li>
          <li>å¿…è¦ã«å¿œã˜ã¦ç‰¹å®šå•†å–å¼•æ³•è¡¨ç¤ºãƒ»å¤ç‰©å•†è¨±å¯ãŒå¿…è¦ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆäº‹æ¥­è€…è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ï¼‰ã€‚</li>
        </ol>
        <div style="margin-top:8px">
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;">
            <input type="checkbox" id="tosAgreeChk"> æœ¬è¦ç´„ã«åŒæ„ã—ã¾ã™ï¼ˆæ¬¡å›ä»¥é™ã¯è¡¨ç¤ºã—ãªã„ï¼‰
          </label>
        </div>
      </div>
      <div class="footer">
        <span class="note">å­¦å†…å‚è€ƒç”¨ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</span>
        <div style="display:flex;gap:8px">
          <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
          <button id="tosAgreeBtn" class="btn primary" value="ok">åŒæ„ã—ã¦é–‰ã˜ã‚‹</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- äº‹æ¥­è€…ãƒ»æ³•ä»¤æƒ…å ±ï¼ˆç‰¹å•†æ³•è¡¨ç¤ºãƒ»å¤ç‰©å•†è¨±å¯No.ãªã©ï¼‰ -->
  <dialog id="biz">
    <form method="dialog">
      <div class="modal-head">
        <strong>äº‹æ¥­è€…ãƒ»æ³•ä»¤æƒ…å ±</strong>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div><label>äº‹æ¥­è€…åï¼ˆå›£ä½“/ã‚µãƒ¼ã‚¯ãƒ«åå¯ï¼‰<br><input id="bz_name" class="input" placeholder="Campus Reuse Books Project"></label></div>
          <div><label>ä»£è¡¨è€…å<br><input id="bz_owner" class="input" placeholder="å±±ç”° å¤ªéƒ"></label></div>
        </div>
        <div class="row">
          <div><label>æ‰€åœ¨åœ°ï¼ˆå­¦å†…ä½æ‰€å¯ï¼‰<br><input id="bz_addr" class="input" placeholder="ã€’700-0000 å²¡å±±å¸‚..."></label></div>
          <div><label>é€£çµ¡å…ˆï¼ˆãƒ¡ãƒ¼ãƒ«/é›»è©±ï¼‰<br><input id="bz_contact" class="input" placeholder="example@univ.jp / 090-xxxx-xxxx"></label></div>
        </div>
        <div class="row">
          <div><label>ã‚¦ã‚§ãƒ–URLï¼ˆä»»æ„ï¼‰<br><input id="bz_url" class="input" placeholder="https://..."></label></div>
          <div><label>å¤ç‰©å•†è¨±å¯ç•ªå·ï¼ˆä»»æ„ï¼‰<br><input id="bz_kobutsu" class="input" placeholder="å²¡å±±çœŒå…¬å®‰å§”å“¡ä¼š ç¬¬XXXXå·"></label></div>
        </div>
        <div class="row row-1">
          <label>ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜ï¼ˆè‡ªå‹•ç”Ÿæˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</label>
          <div id="tokusho" class="section" style="font-size:13px;line-height:1.7"></div>
        </div>
      </div>
      <div class="footer">
        <div style="display:flex;gap:8px">
          <button id="bz_save" class="btn primary">ä¿å­˜</button>
          <button id="bz_clear" class="btn ghost">æ¶ˆå»</button>
        </div>
        <button class="btn ghost" value="close">é–‰ã˜ã‚‹</button>
      </div>
    </form>
  </dialog>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
  <footer>
    <p><strong>å…è²¬äº‹é …ï¼ˆDisclaimerï¼‰</strong></p>
    <p>
      æœ¬ã‚µã‚¤ãƒˆã¯å­¦å†…é™å®šã®æ•™æãƒ»æ›¸ç±ã®å†åˆ©ç”¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚å–å¼•ã¯è‡ªå·±è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚
      é‹å–¶ã¯ã€æ²è¼‰å†…å®¹ãƒ»å–å¼•ã®å®‰å…¨æ€§ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã«é–¢ã—ã¦ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
    </p>
    <div class="footlinks">
      <a href="javascript:void(0)" id="openTos2">åˆ©ç”¨è¦ç´„</a>
      <span>ãƒ»</span>
      <a href="javascript:void(0)" id="openBiz">ç‰¹å®šå•†å–å¼•æ³•ã®è¡¨ç¤º</a>
      <span>ãƒ»</span>
      <a href="#events">ã‚¤ãƒ™ãƒ³ãƒˆ</a>
      <span>ãƒ»</span>
      <a href="#top">ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸</a>
    </div>
    <p style="margin-top:8px;">Â© 2025 Campus Reuse Books Project</p>
  </footer>

  <script>
    const $ = (s,el=document)=>el.querySelector(s);
    const $$ = (s,el=document)=>Array.from(el.querySelectorAll(s));
    const storeKey = 'crb.books.real.v1';
    const couponKey = 'crb.coupons.v1';
    const tosKey = 'crb.tos.agreed.v2';
    const pickupKey = 'crb.pickups.v1';
    const bizKey = 'crb.biz.v1';
    const buybackIndexKey = 'crb.buybackIndex.v1';
    let books = [], coupons=[], pickups=[], biz={}, buybackIndex=[];
    let editingId = null;

    function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}
    function fmtJPY(n){ return new Intl.NumberFormat('ja-JP').format(Math.round(n||0)) }
    function avg(arr){ return arr.reduce((s,n)=>s+n,0) / (arr.length||1) }
    function median(arr){ if(arr.length===0) return 0; const a = arr.slice().sort((x,y)=>x-y); const m = Math.floor(a.length/2); return a.length%2 ? a[m] : (a[m-1]+a[m])/2; }
    function hashCode(str){ let h=0; for(let i=0;i<str.length;i++){ h = (h<<5)-h + str.charCodeAt(i); h|=0 } return Math.abs(h) }
    function coverFromTitle(title='BOOK', author=''){
      const seed = hashCode(title+author);
      const hue = seed % 360, hue2 = (hue+40)%360;
      const esc = s=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      const svg = `
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 900'>
          <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
            <stop offset='0%' stop-color='hsl(${hue},60%,60%)'/>
            <stop offset='100%' stop-color='hsl(${hue2},60%,50%)'/>
          </linearGradient></defs>
          <rect width='1200' height='900' fill='url(#g)'/>
          <rect x='80' y='80' width='1040' height='740' rx='28' ry='28' fill='rgba(255,255,255,0.22)'/>
          <text x='100' y='360' font-family='Hiragino Kaku Gothic ProN, Noto Sans JP, sans-serif' font-weight='800' font-size='96' fill='white'>${esc(title).slice(0,18)}</text>
          <text x='100' y='450' font-family='Hiragino Kaku Gothic ProN, Noto Sans JP, sans-serif' font-weight='700' font-size='52' fill='rgba(255,255,255,0.9)'>${esc(author||'').slice(0,22)}</text>
          <text x='100' y='540' font-family='Menlo, monospace' font-size='28' fill='rgba(255,255,255,0.85)'>Campus Reuse Books</text>
        </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    const condFactorBuyback = { 'æ–°å“åŒæ§˜': 0.60, 'è‰¯ã„': 0.45, 'å¯': 0.25 };
    const condFactorList = { 'æ–°å“åŒæ§˜': 0.78, 'è‰¯ã„': 0.62, 'å¯': 0.42 };
    function findListingMatches(query){
      const q = (query||'').trim().toLowerCase(); if(!q) return [];
      return books.filter(b => [b.title, b.author].join('\n').toLowerCase().includes(q));
    }
    function baseFromListingOrMSRP(query){
      const matches = findListingMatches(query);
      if(matches.length){ return { base: median(matches.map(m=>m.price)), count: matches.length, source: 'listing_median' }; }
      const q = (query||'').trim().toLowerCase();
      const hit = buybackIndex.find(x => x.keyword && q.includes(String(x.keyword).toLowerCase()) );
      if(hit) return { base: hit.msrp, count: 0, source: 'msrp' };
      return null;
    }
    function estimateBuyback(base, condition){
      const k = condFactorBuyback[condition] ?? condFactorBuyback['è‰¯ã„'];
      const mid = base * k; return { mid, low: mid*0.85, high: mid*1.15 };
    }
    function recommendListPrice(query, condition){
      const base = baseFromListingOrMSRP(query); if(!base) return null;
      const listK = condFactorList[condition] ?? condFactorList['è‰¯ã„'];
      const buyback = estimateBuyback(base.base, condition).mid;
      let rec = base.base * listK; const floor = buyback * 1.10; if(rec < floor) rec = Math.max(rec, floor);
      return { source: base.source, base: base.base, count: base.count, rec: rec, range: { low: rec*0.9, high: rec*1.1 }, buybackMid: buyback };
    }

    // coupons
    const couponKeyLS = couponKey;
    function loadCoupons(){ try{ coupons = JSON.parse(localStorage.getItem(couponKeyLS) || '[]') }catch{ coupons=[] } }
    function saveCoupons(){ localStorage.setItem(couponKeyLS, JSON.stringify(coupons)) }
    function applyCoupon(code, price, category){
      code = (code||'').trim(); if(!code) return {price, applied:null};
      const now = new Date().toISOString().slice(0,10);
      const c = coupons.find(x=>x.code===code);
      if(!c) return {price, applied:null};
      if(c.until && c.until < now) return {price, applied:null};
      if(c.min && price < c.min) return {price, applied:null};
      if(c.cat && c.cat.length){
        if(!c.cat.includes(category)) return {price, applied:null};
      }
      let newPrice = price;
      if(c.type==='pct') newPrice = Math.max(0, Math.round(price*(100 - c.value)/100));
      else newPrice = Math.max(0, price - c.value);
      return {price:newPrice, applied:c};
    }

    // pickups / biz
    function loadBiz(){ try{ biz = JSON.parse(localStorage.getItem(bizKey) || '{}') }catch{ biz={} } }
    function saveBiz(){ localStorage.setItem(bizKey, JSON.stringify(biz)) }
    function renderTokusho(){
      const {name, owner, addr, contact, url, kobutsu} = biz;
      $('#tokusho').innerHTML = `
        <div><strong>è²©å£²æ¥­è€…</strong>ï¼š${name||'-'}</div>
        <div><strong>é‹å–¶è²¬ä»»è€…</strong>ï¼š${owner||'-'}</div>
        <div><strong>æ‰€åœ¨åœ°</strong>ï¼š${addr||'-'}</div>
        <div><strong>é€£çµ¡å…ˆ</strong>ï¼š${contact||'-'}</div>
        <div><strong>URL</strong>ï¼š${url||'-'}</div>
        <div><strong>å¤ç‰©å•†è¨±å¯ç•ªå·</strong>ï¼š${kobutsu||'ï¼ˆå¿…è¦ã«å¿œã˜ã¦ç”³è«‹ï¼‰'}</div>
        <div><strong>è²©å£²ä¾¡æ ¼</strong>ï¼šå„å•†å“ãƒšãƒ¼ã‚¸ã«ç¨è¾¼ä¾¡æ ¼ã‚’è¡¨ç¤º</div>
        <div><strong>å•†å“ä»£é‡‘ä»¥å¤–ã®å¿…è¦æ–™é‡‘</strong>ï¼šå¯¾é¢å¼•æ¸¡ã—åŸå‰‡ï¼é…é€æ™‚ã®é€æ–™ã¯å®Ÿè²»</div>
        <div><strong>ä»£é‡‘ã®æ”¯æ‰•æ–¹æ³•ãƒ»æ™‚æœŸ</strong>ï¼šç¾é‡‘ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹ç­‰ã€å—ã‘æ¸¡ã—æ™‚ã«æ”¯æ‰•ã„</div>
        <div><strong>å¼•æ¸¡æ™‚æœŸ</strong>ï¼šåˆæ„æ—¥æ™‚ã«å—ã‘æ¸¡ã—</div>
        <div><strong>è¿”å“ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«</strong>ï¼šåŸå‰‡ä¸å¯ã€‚ãŸã ã—åˆæ„ã«ã‚ˆã‚Š7æ—¥ä»¥å†…ã®è¿”å“å¯ï¼ˆçŠ¶æ…‹ç›¸é•ç­‰ï¼‰</div>
      `;
    }
    function loadPickups(){ try{ pickups = JSON.parse(localStorage.getItem(pickupKey) || '[]') }catch{ pickups=[] } }
    function savePickups(){ localStorage.setItem(pickupKey, JSON.stringify(pickups)) }
    function ensurePickupOptions(){
      const sel = $('#pickup'); const olds = new Set(Array.from(sel.options).map(o=>o.value));
      pickups.forEach(p=>{ if(!olds.has(p)){ const opt = document.createElement('option'); opt.value=p; opt.textContent=p; sel.appendChild(opt); } });
    }

    // data IO
    function load(){
      try{ books = JSON.parse(localStorage.getItem(storeKey) || '[]') }catch{ books=[] }
      if(!books || books.length===0){
books = [
  {
    id: uid(),
    title: '1ã‹ã‚‰ã®çµŒå–¶å­¦',
    author: 'åŠ è­·é‡å¿ ç”·ãƒ»å‰æ‘å…¸ä¹…',
    category: 'æ•™ç§‘æ›¸',
    condition: 'è‰¯ã„',
    price: 2400,
    seller: 'çµŒå–¶å­¦éƒ¨',
    contact: '@seller1',
    image: 'img/keieigaku.jpg',
    description: 'çµŒå–¶å­¦ã®åŸºæœ¬ã‚’ä½“ç³»çš„ã«å­¦ã¹ã‚‹å…¥é–€æ›¸ã€‚',
    pickup: 'å›³æ›¸é¤¨å‰',
    coupon: '',
    createdAt: Date.now()-1000*60*60*24*3,
    sold: false
  },
  {
    id: uid(),
    title: '1ã‹ã‚‰ã®ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°',
    author: 'è¥¿å·è‹±å½¦ãƒ»æ»è°·è¦š',
    category: 'æ•™ç§‘æ›¸',
    condition: 'è‰¯ã„',
    price: 2400,
    seller: 'æƒ…å ±ç†å·¥å­¦éƒ¨',
    contact: '@seller2',
    image: 'img/digital-marketing.jpg',
    description: 'ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚ä»£ã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‰‹æ³•ã‚’åŸºç¤ã‹ã‚‰è§£èª¬ã™ã‚‹å®šç•ªãƒ†ã‚­ã‚¹ãƒˆã€‚',
    pickup: 'å­¦ç”Ÿä¼šé¤¨',
    coupon: '',
    createdAt: Date.now()-1000*60*60*24*2,
    sold: false
  },
  {
    id: uid(),
    title: '1ã‹ã‚‰ã®æµé€šè«–',
    author: 'çŸ³åŸæ­¦æ”¿ã»ã‹',
    category: 'æ•™ç§‘æ›¸',
    condition: 'è‰¯ã„',
    price: 2400,
    seller: 'çµŒå–¶å­¦éƒ¨',
    contact: '@seller3',
    image: 'img/ryutsuron.jpg',
    description: 'æµé€šã®ä»•çµ„ã¿ã¨åŸºç¤ç†è«–ã‚’èº«è¿‘ãªäº‹ä¾‹ã‹ã‚‰è§£èª¬ã€‚',
    pickup: 'å›³æ›¸é¤¨å‰',
    coupon: '',
    createdAt: Date.now()-1000*60*60*24,
    sold: false
  },
  {
    id: uid(),
    title: '1ã‹ã‚‰ã®ç—…é™¢çµŒå–¶',
    author: 'æœ¨æ‘æ†²æ´‹ã»ã‹',
    category: 'æ•™ç§‘æ›¸',
    condition: 'è‰¯ã„',
    price: 2400,
    seller: 'ç”Ÿå‘½ç§‘å­¦éƒ¨',
    contact: '@seller4',
    image: 'img/byoin-keiei.jpg',
    description: 'åŒ»ç™‚æ©Ÿé–¢ã®çµŒå–¶ã‚’åŸºç¤ã‹ã‚‰å­¦ã¹ã‚‹å®Ÿè·µå…¥é–€æ›¸ã€‚',
    pickup: 'C1å·é¤¨å‰',
    coupon: '',
    createdAt: Date.now()-1000*60*60*6,
    sold: false
  },
  {
    id: uid(),
    title: '1ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿åˆ†æ',
    author: 'å¤å·ä¸€éƒãƒ»ä¸ŠåŸæ¸‰',
    category: 'æ•™ç§‘æ›¸',
    condition: 'è‰¯ã„',
    price: 2400,
    seller: 'æƒ…å ±ç†å·¥å­¦éƒ¨',
    contact: '@seller5',
    image: 'img/data-bunseki.jpg',
    description: 'ç¤¾ä¼šäººã®å®Ÿä¾‹ã‚’é€šã—ã¦ãƒ‡ãƒ¼ã‚¿åˆ†æã‚’ä½“é¨“çš„ã«å­¦ã¶æ•™ç§‘æ›¸ã€‚',
    pickup: 'æƒ…å ±ç³»å®Ÿé¨“å®¤å‰',
    coupon: '',
    createdAt: Date.now()-1000*60*60*3,
    sold: false
  },
  {
    id: uid(),
    title: 'ã‚ˆãã‚ã‹ã‚‹æ•™è‚²å¿ƒç†å­¦ ç¬¬2ç‰ˆ',
    author: 'ä¸­æ¾¤æ½¤',
    category: 'æ•™ç§‘æ›¸',
    condition: 'è‰¯ã„',
    price: 2200,
    seller: 'æ•™è‚²å­¦éƒ¨',
    contact: '@seller6',
    image: 'img/kyoiku-shinri.jpg',
    description: 'æ•™è‚²å¿ƒç†å­¦ã®åŸºæœ¬æ¦‚å¿µã‚’ä¸å¯§ã«è§£èª¬ã—ãŸå…¥é–€æ›¸ã€‚',
    pickup: 'æ•™è‚²å­¦éƒ¨æ£Ÿå‰',
    coupon: '',
    createdAt: Date.now()-1000*60*60,
    sold: false
  }
];
save();
      }

      if(!localStorage.getItem(pickupKey)){
        pickups = ['å›³æ›¸é¤¨å‰','å­¦ç”Ÿä¼šé¤¨','é£Ÿå ‚å‰']; savePickups();
      } else loadPickups();
      loadBiz(); renderTokusho();
      loadCoupons();
      if(!coupons.length){
        coupons = [{code:'WELCOME10', type:'pct', value:10, min:0, cat:[], until:''}];
        saveCoupons();
      }
      try{
        buybackIndex = JSON.parse(localStorage.getItem(buybackIndexKey) || '[]');
        if(!buybackIndex.length){
          buybackIndex = [
            {keyword:'ç·šå½¢ä»£æ•°', msrp: 2500},
            {keyword:'Python', msrp: 3200},
            {keyword:'TOEIC', msrp: 3000},
            {keyword:'çµ±è¨ˆå­¦å…¥é–€', msrp: 2800}
          ];
          localStorage.setItem(buybackIndexKey, JSON.stringify(buybackIndex));
        }
      }catch{ buybackIndex=[] }
    }
    function save(){ localStorage.setItem(storeKey, JSON.stringify(books)); }

    function render(){
      ensurePickupOptions();
      const q = $('#q').value.trim().toLowerCase();
      const cat = $('#cat').value; const cond = $('#cond').value; const sort = $('#sort').value; const pickup = $('#pickup').value;
      let data = books.slice();
      if(q){ data = data.filter(b => [b.title,b.author,b.category].join('\n').toLowerCase().includes(q)) }
      if(cat){ data = data.filter(b => b.category===cat) }
      if(cond){ data = data.filter(b => b.condition===cond) }
      if(pickup){ data = data.filter(b => (b.pickup||'')===pickup) }
      if(sort==='price_asc') data.sort((a,b)=>a.price-b.price);
      else if(sort==='price_desc') data.sort((a,b)=>b.price-a.price);
      else data.sort((a,b)=>b.createdAt-a.createdAt);

      const prices = data.map(b=>b.price);
      const sAvg = prices.length? fmtJPY(avg(prices)) : '-';
      const sMed = prices.length? fmtJPY(median(prices)) : '-';
      $('#stats').innerHTML = `æ²è¼‰ <strong>${data.length}</strong> / ç· ${books.length} ä»¶ã€€<span class="pill">å¹³å‡ Â¥${sAvg}</span> <span class="pill">ä¸­å¤®å€¤ Â¥${sMed}</span>`;
      $('#kpi').innerHTML = `<span class="pill">å—ã‘æ¸¡ã—åœ°ç‚¹: ${pickups.length} ç®‡æ‰€</span><span class="pill">ã‚¯ãƒ¼ãƒãƒ³: ${coupons.length} ä»¶</span>`;

      const list = $('#list'); list.innerHTML = '';
      $('#empty').hidden = data.length !== 0;
      for(const b of data){
        const card = document.createElement('div');
        card.className = 'card';
        const t = document.createElement('div'); t.className = 'thumb';
        const imgSrc = b.image && b.image.trim() ? b.image : coverFromTitle(b.title, b.author);
        t.innerHTML = `<img src="${imgSrc}" alt="${b.title}">`;
        const body = document.createElement('div'); body.className = 'body';
        const rec = recommendListPrice(b.title, b.condition);
        const market = rec ? `<div class="muted">ç›¸å ´: Â¥${fmtJPY(rec.range.low)}ã€œÂ¥${fmtJPY(rec.range.high)}ï¼ˆæ¨å¥¨ Â¥${fmtJPY(rec.rec)}ï¼‰</div>` : '';

        const coup = applyCoupon(b.coupon, b.price, b.category);
        const priceHtml = coup.applied
          ? `<div class="price">Â¥${fmtJPY(coup.price)} <del>Â¥${fmtJPY(b.price)}</del> <span class="badge">Coupon: ${coup.applied.code}</span></div>`
          : `<div class="price">Â¥${fmtJPY(b.price)}</div>`;

        body.innerHTML = `
          <div class="title">${b.title}</div>
          <div class="muted">${b.author || ''}</div>
          <div class="muted">${b.category}ï¼${b.condition}ï¼å—ã‘æ¸¡ã—ï¼š${b.pickup||'-'}</div>
          ${priceHtml}
          ${market}
          <div class="muted">
            æ”¯æ‰•æ–¹æ³•ï¼š${b.payMethod || 'æœªæŒ‡å®š'}
            ${
              b.payLink
                ? ` ï¼ <a href="${b.payLink}" target="_blank" rel="noopener noreferrer">æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’é–‹ã</a>`
                : ''
            }
          </div>
          ${b.description?`<div class="muted">${b.description}</div>`:''}
          <div class="muted">å‡ºå“è€…ï¼š${b.seller || '-'}ã€€é€£çµ¡ï¼š${b.contact || '-'}</div>
          <div class="actions">
            <span class="badge">ID: ${b.id.slice(0,6)}</span>
            ${b.sold?'<span class="badge sold">SOLD</span>':''}
            ${b.paid?'<span class="badge">æ”¯æ‰•ã„æ¸ˆã¿</span>':''}
            <button class="btn ghost" data-edit="1">ç·¨é›†</button>
            <button class="btn warn" data-sold="1">${b.sold?'è²©å£²å¯èƒ½ã«æˆ»ã™':'SOLDã«ã™ã‚‹'}</button>
            <button class="btn ghost" data-paid="1">${b.paid ? 'æœªæ‰•ã„ã«æˆ»ã™' : 'æ”¯æ‰•ã„æ¸ˆã¿ã«ã™ã‚‹'}</button>
            <button class="btn ghost" data-buyback="1" title="ã“ã®æ›¸ç±åã§è²·å–ç›®å®‰ã‚’è¡¨ç¤º">è²·å–ç›®å®‰</button>
          </div>
        `;
        card.appendChild(t); card.appendChild(body);
        list.appendChild(card);
        $('[data-edit]', body).onclick = ()=> openEdit(b.id);
        $('[data-sold]', body).onclick = ()=> toggleSold(b.id);
        const paidBtn = $('[data-paid]', body);
        if(paidBtn) paidBtn.onclick = ()=> togglePaid(b.id);
        $('[data-buyback]', body).onclick = ()=> openBuybackPrefill(b.title, b.condition);
      }
    }

    function openCreate(){ editingId = null; $('#modalTitle').textContent='å‡ºå“ã‚’ä½œæˆ'; $('#delBtn').style.display='none'; fillForm({}); $('#suggestInfo').innerHTML=''; $('#modal').showModal(); }
    function openEdit(id){ editingId = id; const b = books.find(x=>x.id===id); $('#modalTitle').textContent='å‡ºå“ã‚’ç·¨é›†'; $('#delBtn').style.display='inline-flex'; fillForm(b); $('#suggestInfo').innerHTML=''; $('#modal').showModal(); }
    function fillForm(b){
      $('#f_title').value=b.title||''; $('#f_author').value=b.author||''; $('#f_cat').value=b.category||'æ•™ç§‘æ›¸'; $('#f_cond').value=b.condition||'è‰¯ã„';
      $('#f_price').value=b.price||''; $('#f_img').value=b.image||''; $('#f_seller').value=b.seller||''; $('#f_contact').value=b.contact||'';
      $('#f_desc').value=b.description||''; $('#f_pickup').value=b.pickup||''; $('#f_coupon').value=b.coupon||'';
      $('#f_payMethod').value=b.payMethod||''; $('#f_payLink').value=b.payLink||'';
    }
    function readForm(){
      return {
        title: $('#f_title').value.trim(),
        author: $('#f_author').value.trim(),
        category: $('#f_cat').value,
        condition: $('#f_cond').value,
        price: parseInt($('#f_price').value||'0'),
        image: $('#f_img').value.trim(),
        seller: $('#f_seller').value.trim(),
        contact: $('#f_contact').value.trim(),
        description: $('#f_desc').value.trim(),
        pickup: $('#f_pickup').value.trim(),
        coupon: $('#f_coupon').value.trim(),
        payMethod: $('#f_payMethod').value,
        payLink: $('#f_payLink').value.trim()
      }
    }
    function onSave(e){ e.preventDefault(); const v = readForm(); if(!v.title||!v.price){alert('æ›¸åã¨ä¾¡æ ¼ã¯å¿…é ˆã§ã™'); return}
      if(!v.image){ v.image = coverFromTitle(v.title, v.author); }
      if(v.pickup && !pickups.includes(v.pickup)){ pickups.push(v.pickup); savePickups(); }
      if(editingId){ const i = books.findIndex(x=>x.id===editingId); books[i] = {...books[i], ...v}; }
      else{ books.unshift({id:uid(), createdAt:Date.now(), sold:false, paid:false, ...v}); }
      save(); render(); $('#modal').close();
    }
    function onDelete(e){ e.preventDefault(); if(!editingId) return; if(!confirm('ã“ã®å‡ºå“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return; books = books.filter(x=>x.id!==editingId); save(); render(); $('#modal').close(); }
    function toggleSold(id){ const b = books.find(x=>x.id===id); b.sold=!b.sold; save(); render(); }
    function togglePaid(id){ const b = books.find(x=>x.id===id); if(!b) return; b.paid = !b.paid; save(); render(); }
    $('#genCoverBtn').onclick = ()=>{ const title = $('#f_title').value || 'BOOK'; const author = $('#f_author').value || ''; $('#f_img').value = coverFromTitle(title, author); };
    $('#suggestBtn').onclick = ()=>{
      const title = $('#f_title').value; const cond = $('#f_cond').value; const rec = recommendListPrice(title, cond); const info = $('#suggestInfo');
      if(!rec){ info.innerHTML = 'ç›¸å ´ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆä¸€è¦§ã«è¿‘ã„æ›¸ç±ã‚’å¢—ã‚„ã™ã‹ã€å‚è€ƒå®šä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ï¼‰ã€‚'; return; }
      $('#f_price').value = Math.round(rec.rec);
      const src = rec.source==='listing_median' ? `æ²è¼‰${rec.count}ä»¶ã®ä¸­å¤®å€¤` : 'å‚è€ƒå®šä¾¡';
      info.innerHTML = `åŸºæº–ï¼š${src} = Â¥${fmtJPY(rec.base)} ï¼ æ¨å¥¨ï¼š<strong>Â¥${fmtJPY(rec.rec)}</strong>ï¼ˆæ¨å¥¨ãƒ¬ãƒ³ã‚¸ Â¥${fmtJPY(rec.range.low)}ã€œÂ¥${fmtJPY(rec.range.high)}ã€è²·å–ç›®å®‰ Â¥${fmtJPY(rec.buybackMid)} ç¨‹åº¦ï¼‰`;
    };

    function findListingBase(query){
      const q = (query||'').trim().toLowerCase(); if(!q) return null;
      const matches = books.filter(b => [b.title, b.author].join('\n').toLowerCase().includes(q));
      if(matches.length){ return { base: avg(matches.map(m=>m.price)), count: matches.length, source: 'listing' }; }
      const hit = buybackIndex.find(x => x.keyword && q.includes(String(x.keyword).toLowerCase()) ); if(hit){ return { base: hit.msrp, count: 0, source: 'msrp' }; }
      return null;
    }
    function estimateBuybackOld(base, condition){ const k = condFactorBuyback[condition] ?? condFactorBuyback['è‰¯ã„']; const est = base * k; return { mid: est, low: est*0.85, high: est*1.15 }; }
    function openBuyback(){ $('#bb_query').value = ''; $('#bb_cond').value = 'è‰¯ã„'; $('#bb_result').innerHTML = ''; $('#buyback').showModal(); }
    function openBuybackPrefill(title, condition='è‰¯ã„'){ $('#bb_query').value = title || ''; $('#bb_cond').value = condition || 'è‰¯ã„'; $('#bb_result').innerHTML = ''; $('#buyback').showModal(); calcBuyback(); }
    function calcBuyback(){
      const q = $('#bb_query').value; const c = $('#bb_cond').value; const res = findListingBase(q); const result = $('#bb_result');
      if(!res){ result.innerHTML = 'è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>ãƒ»åŒåã®æ²è¼‰ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã‹ã€<br>ãƒ»ã€Œå‚è€ƒå®šä¾¡ãƒ‡ãƒ¼ã‚¿(JSON)ã€ã‚’èª­ã¿è¾¼ã‚“ã§å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'; return; }
      const range = estimateBuybackOld(res.base, c);
      const srcLabel = res.source==='listing' ? `æ²è¼‰${res.count}ä»¶ã®å¹³å‡ä¾¡æ ¼` : 'å‚è€ƒå®šä¾¡ï¼ˆèª­ã¿è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ï¼‰';
      result.innerHTML = `<div>åŸºæº–ï¼š<strong>${srcLabel}</strong> = Â¥${fmtJPY(res.base)}</div><div>çŠ¶æ…‹ä¿‚æ•°ï¼ˆ${c}ï¼‰= ${((condFactorBuyback[c]||0)*100).toFixed(0)}%</div><div style="margin-top:6px;">ç›®å®‰ã®è²·å–ä¾¡æ ¼ï¼š<strong>Â¥${fmtJPY(range.mid)}</strong>ï¼ˆãƒ¬ãƒ³ã‚¸ï¼šÂ¥${fmtJPY(range.low)}ã€œÂ¥${fmtJPY(range.high)}ï¼‰</div>`;
    }
    function importBuybackIndex(file){
      const r = new FileReader();
      r.onload = ()=>{ try{ const data = JSON.parse(r.result); if(Array.isArray(data)){ buybackIndex = data.filter(x => x && typeof x.keyword === 'string' && Number.isFinite(Number(x.msrp))); localStorage.setItem(buybackIndexKey, JSON.stringify(buybackIndex)); alert('å‚è€ƒå®šä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ'); } else { alert('JSONã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆé…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰'); } }catch{ alert('JSONã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ'); } };
      r.readAsText(file);
    }

    function renderCoupons(){
      const el = $('#cp_list');
      if(!coupons.length){ el.innerHTML='ï¼ˆç™»éŒ²ãªã—ï¼‰'; return; }
      el.innerHTML = coupons.map(c=>{
        const cat = (c.cat||[]).join(' , ') || 'å…¨ä½“';
        const until = c.until || 'â€”';
        const v = c.type==='pct' ? (c.value+'%OFF') : ('Â¥'+fmtJPY(c.value)+' OFF');
        return `<div class="pill">${c.code} | ${v} | æœ€å°Â¥${fmtJPY(c.min||0)} | ã‚«ãƒ†ã‚´ãƒª:${cat} | æœŸé™:${until} <button data-del="${c.code}" class="btn ghost" style="padding:2px 8px;margin-left:6px">å‰Šé™¤</button></div>`;
      }).join('');
      $$('[data-del]','#coupon').forEach(b=> b.onclick = ()=>{ coupons = coupons.filter(x=>x.code!==b.getAttribute('data-del')); saveCoupons(); renderCoupons(); render(); });
    }

    function fillBizForm(){ $('#bz_name').value=biz.name||''; $('#bz_owner').value=biz.owner||''; $('#bz_addr').value=biz.addr||''; $('#bz_contact').value=biz.contact||''; $('#bz_url').value=biz.url||''; $('#bz_kobutsu').value=biz.kobutsu||''; renderTokusho(); }

    function exportData(){ const blob = new Blob([JSON.stringify({books,coupons,pickups,biz},null,2)], {type:'application/json'}); const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:'crb-data.json'}); a.click(); URL.revokeObjectURL(a.href) }
    function importData(file){ const r = new FileReader(); r.onload = ()=>{ try{ const data = JSON.parse(r.result); if(data.books){ books = data.books } if(data.coupons){ coupons = data.coupons } if(data.pickups){ pickups = data.pickups } if(data.biz){ biz = data.biz } save(); saveCoupons(); savePickups(); saveBiz(); ensurePickupOptions(); render(); alert('èª­ã¿è¾¼ã¿å®Œäº†') }catch{ alert('JSONã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“') } }; r.readAsText(file) }

    $('#addBtn').onclick = openCreate;
    $('#saveBtn').onclick = onSave;
    $('#delBtn').onclick = onDelete;
    $('#exportBtn').onclick = exportData;
    $('#importFile').onchange = e=>{ const f = e.target.files[0]; if(f) importData(f) };
    ['q','cat','cond','sort','pickup'].forEach(id=>{ document.getElementById(id).addEventListener('input', render); document.getElementById(id).addEventListener('change', render) });
    $('#buybackBtn').onclick = ()=> $('#buyback').showModal();
    $('#bb_calc').onclick = ()=> calcBuyback();
    $('#buybackFile').onchange = e=>{ const f = e.target.files[0]; if(f) importBuybackIndex(f); };
    $('#couponBtn').onclick = ()=>{ renderCoupons(); $('#coupon').showModal(); };
    $('#cp_add').onclick = ()=>{
      const c = {
        code: $('#cp_code').value.trim(),
        type: $('#cp_type').value,
        value: parseInt($('#cp_value').value||'0'),
        min: parseInt($('#cp_min').value||'0'),
        cat: ($('#cp_cat').value||'').split(',').map(s=>s.trim()).filter(Boolean),
        until: $('#cp_until').value
      };
      if(!c.code||!c.value){ alert('ã‚³ãƒ¼ãƒ‰ã¨å€¤å¼•å€¤ã‚’å…¥åŠ›'); return; }
      const i = coupons.findIndex(x=>x.code===c.code);
      if(i>=0) coupons[i]=c; else coupons.push(c);
      saveCoupons(); renderCoupons(); render();
    };
    $('#cp_clear').onclick = ()=>{ if(confirm('å…¨ã‚¯ãƒ¼ãƒãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')){ coupons=[]; saveCoupons(); renderCoupons(); render(); } };

    $('#openTos').onclick = ()=> $('#tos').showModal();
    $('#openTos2').onclick = ()=> $('#tos').showModal();
    $('#tosAgreeBtn').onclick = ()=>{ if($('#tosAgreeChk').checked){ localStorage.setItem(tosKey,'1') } };

    $('#bizBtn').onclick = ()=>{ fillBizForm(); $('#biz').showModal(); };
    $('#openBiz').onclick = ()=>{ fillBizForm(); $('#biz').showModal(); };
    $('#bz_save').onclick = (e)=>{ e.preventDefault(); biz = {name:$('#bz_name').value, owner:$('#bz_owner').value, addr:$('#bz_addr').value, contact:$('#bz_contact').value, url:$('#bz_url').value, kobutsu:$('#bz_kobutsu').value}; saveBiz(); renderTokusho(); alert('ä¿å­˜ã—ã¾ã—ãŸ'); };
    $('#bz_clear').onclick = (e)=>{ e.preventDefault(); if(confirm('äº‹æ¥­è€…æƒ…å ±ã‚’æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ')){ biz={}; saveBiz(); renderTokusho(); } };

    (function init(){
      load(); render(); loadCoupons(); ensurePickupOptions();
      try{ if(localStorage.getItem(tosKey)!=='1'){ $('#tos').showModal(); } }catch{}
    })();
  
    // ===== Riverlight event: Auth (local) + RSVP (per user, local) + countdown (optional) =====
// â€» å­¦å†…ã®ãƒ‡ãƒ¢ç”¨ï¼šID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨å‚åŠ è¨˜éŒ²ã¯ã€Œã“ã®ç«¯æœ«ãƒ»ã“ã®URLã€ã® localStorage ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
const usersKey   = 'crb.auth.users.v1';
const sessionKey = 'crb.auth.session.v1';
const eventKey   = 'crb.event.riverlight.rsvp.v1';

function loadUsers(){ try{ return JSON.parse(localStorage.getItem(usersKey) || '[]') }catch{ return [] } }
function saveUsers(users){ localStorage.setItem(usersKey, JSON.stringify(users||[])); }
function loadSession(){ try{ return JSON.parse(localStorage.getItem(sessionKey) || 'null') }catch{ return null } }
function saveSession(s){ localStorage.setItem(sessionKey, JSON.stringify(s)); }

function buf2hex(buffer){
  const bytes = new Uint8Array(buffer);
  return [...bytes].map(b=>b.toString(16).padStart(2,'0')).join('');
}
async function sha256(str){
  const enc = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-256', enc);
  return buf2hex(hash);
}

function uid(){ return 'u_' + Math.random().toString(16).slice(2) + Date.now().toString(16); }
function salt(){ return Math.random().toString(16).slice(2) + Math.random().toString(16).slice(2); }

async function registerLocal(id, name, pw, pw2){
  id = (id||'').trim();
  name = (name||'').trim();
  if(!id) throw new Error('ãƒ­ã‚°ã‚¤ãƒ³IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  if(!name) throw new Error('è¡¨ç¤ºåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  if(!pw) throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  if(pw !== pw2) throw new Error('ç¢ºèªç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚');

  const users = loadUsers();
  if(users.some(u=>u.id === id)) throw new Error('ã“ã®IDã¯æ—¢ã«ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚');

  const s = salt();
  const hash = await sha256(pw + '|' + s);
  const u = { uid: uid(), id, name, salt: s, hash };
  users.push(u);
  saveUsers(users);
  saveSession({ uid: u.uid });
  return u;
}

async function loginLocal(id, pw){
  id = (id||'').trim();
  if(!id) throw new Error('ãƒ­ã‚°ã‚¤ãƒ³IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  if(!pw) throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  const users = loadUsers();
  const u = users.find(x=>x.id === id);
  if(!u) throw new Error('ã“ã®IDã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
  const hash = await sha256(pw + '|' + u.salt);
  if(hash !== u.hash) throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚');
  saveSession({ uid: u.uid });
  return u;
}

function currentUser(){
  const s = loadSession();
  if(!s || !s.uid) return null;
  const users = loadUsers();
  return users.find(u=>u.uid === s.uid) || null;
}
function logoutLocal(){ saveSession(null); }

// RSVP per user (local)
function loadEventRsvp(){ try{ return JSON.parse(localStorage.getItem(eventKey) || '{}') }catch{ return {} } }
function saveEventRsvp(v){ localStorage.setItem(eventKey, JSON.stringify(v||{})) }

function renderAuth(){
  const u = currentUser();
  const el = document.getElementById('authStatus');
  const openBtn = document.getElementById('openAuthBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  if(el) el.textContent = u ? `ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š${u.name}` : 'æœªãƒ­ã‚°ã‚¤ãƒ³';
  if(openBtn) openBtn.style.display = u ? 'none' : '';
  if(logoutBtn) logoutBtn.style.display = u ? '' : 'none';
}

function renderEventRsvp(){
  const u = currentUser();
  const v = loadEventRsvp();
  const el = document.getElementById('eventRsvpStatus');
  const rsvpBtn = document.getElementById('eventRsvpBtn');
  if(!el) return;

  if(!u){
    // show generic status (if any exists on this device)
    if(v && v.joinedAt && v.userName){
      el.textContent = `å‚åŠ è¨˜éŒ²ï¼šã“ã®ç«¯æœ«ã«è¨˜éŒ²ã‚ã‚Šï¼ˆ${v.userName}ï¼‰`;
    }else{
      el.textContent = 'å‚åŠ è¨˜éŒ²ï¼šæœªç™»éŒ²';
    }
    if(rsvpBtn) rsvpBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦å‚åŠ ç™»éŒ²';
    return;
  }

  // logged in
  if(v && v.joinedAt && v.userUid === u.uid){
    const d = new Date(v.joinedAt);
    el.textContent = `å‚åŠ è¨˜éŒ²ï¼šç™»éŒ²æ¸ˆã¿ï¼ˆ${d.toLocaleString('ja-JP')}ï¼‰`;
    if(rsvpBtn) rsvpBtn.textContent = 'å‚åŠ ç™»éŒ²ã‚’è§£é™¤';
  }else{
    el.textContent = 'å‚åŠ è¨˜éŒ²ï¼šæœªç™»éŒ²';
    if(rsvpBtn) rsvpBtn.textContent = 'å‚åŠ ç™»éŒ²ï¼ˆã“ã®ç«¯æœ«ï¼‰';
  }
}

// Auth modal wiring
const authDlg = document.getElementById('auth');
const openAuthBtn = document.getElementById('openAuthBtn');
if(openAuthBtn && authDlg){
  openAuthBtn.addEventListener('click', ()=> authDlg.showModal());
}
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const logoutBtn = document.getElementById('logoutBtn');
const msg = document.getElementById('authMsg');

function setMsg(t){ if(msg) msg.textContent = t || ''; }

if(logoutBtn){
  logoutBtn.addEventListener('click', ()=>{
    logoutLocal();
    renderAuth();
    renderEventRsvp();
    setMsg('');
    alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
  });
}

if(loginBtn){
  loginBtn.addEventListener('click', async ()=>{
    try{
      setMsg('');
      const id = document.getElementById('auth_id')?.value;
      const pw = document.getElementById('auth_pw')?.value;
      await loginLocal(id, pw);
      renderAuth();
      renderEventRsvp();
      setMsg('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸã€‚');
      if(authDlg) authDlg.close();
    }catch(e){
      setMsg(e.message || String(e));
    }
  });
}

if(registerBtn){
  registerBtn.addEventListener('click', async ()=>{
    try{
      setMsg('');
      const id = document.getElementById('auth_id')?.value;
      const name = document.getElementById('auth_name')?.value;
      const pw = document.getElementById('auth_pw')?.value;
      const pw2 = document.getElementById('auth_pw2')?.value;
      await registerLocal(id, name, pw, pw2);
      renderAuth();
      renderEventRsvp();
      setMsg('ç™»éŒ²ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸã€‚');
      if(authDlg) authDlg.close();
    }catch(e){
      setMsg(e.message || String(e));
    }
  });
}

const forgetBtn = document.getElementById('forgetAuthBtn');
if(forgetBtn){
  forgetBtn.addEventListener('click', ()=>{
    if(!confirm('ã“ã®ç«¯æœ«ã«ä¿å­˜ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å…¨å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
    localStorage.removeItem(usersKey);
    localStorage.removeItem(sessionKey);
    // RSVPã¯æ®‹ã™ï¼ˆå¿…è¦ãªã‚‰æ¶ˆã—ã¦ã‚‚OKï¼‰
    renderAuth();
    renderEventRsvp();
    setMsg('å‰Šé™¤ã—ã¾ã—ãŸã€‚');
  });
}

// RSVP button behavior (requires login)
const rsvpBtn = document.getElementById('eventRsvpBtn');
if(rsvpBtn){
  rsvpBtn.addEventListener('click', ()=>{
    const u = currentUser();
    if(!u){
      if(authDlg) authDlg.showModal();
      return;
    }
    const v = loadEventRsvp();
    if(v && v.joinedAt && v.userUid === u.uid){
      if(!confirm('å‚åŠ ç™»éŒ²ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      saveEventRsvp({});
    }else{
      saveEventRsvp({ joinedAt: Date.now(), userUid: u.uid, userName: u.name });
    }
    renderEventRsvp();
  });
}

// countdown (optional)
const EVENT_DATE_ISO = ''; // ä¾‹: '2026-01-20T12:00:00+09:00'  â€»æœªå®šãªã‚‰ç©ºã®ã¾ã¾ã§OK
function renderCountdown(){
  const box = document.getElementById('eventCountdown');
  const timeEl = document.getElementById('eventCountdownTime');
  const noteEl = document.getElementById('eventCountdownNote');
  if(!box || !timeEl || !noteEl) return;
  if(!EVENT_DATE_ISO){ box.hidden = true; noteEl.textContent = 'é–‹å‚¬æ—¥æ™‚ã¯ç¢ºå®šæ¬¡ç¬¬ã€ã‚µã‚¤ãƒˆ/SNSã§å‘ŠçŸ¥ã—ã¾ã™ã€‚'; return; }
  const target = new Date(EVENT_DATE_ISO).getTime();
  const now = Date.now();
  const diff = target - now;
  if(diff <= 0){
    box.hidden = false;
    timeEl.textContent = 'é–‹å‚¬ä¸­ / çµ‚äº†';
    noteEl.textContent = 'ä¼šå ´ã§ã®å‚åŠ ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚';
    return;
  }
  const sec = Math.floor(diff/1000);
  const dd = Math.floor(sec/86400);
  const hh = Math.floor((sec%86400)/3600);
  const mm = Math.floor((sec%3600)/60);
  box.hidden = false;
  timeEl.textContent = `${dd}æ—¥ ${hh}æ™‚é–“ ${mm}åˆ†`;
  noteEl.textContent = 'â€» ã“ã®è¡¨ç¤ºã¯ç«¯æœ«ã®æ™‚åˆ»ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚';
}

// initial render for event area
renderAuth();
renderEventRsvp();
renderCountdown();
setInterval(renderCountdown, 60*1000);


    /* ===== Riverlight Event Login (local only) =====
       - æ—¢å­˜æ©Ÿèƒ½ï¼ˆæ•™ç§‘æ›¸/å‡ºå“/ã‚¯ãƒ¼ãƒãƒ³ç­‰ï¼‰ã«ã¯ä¸€åˆ‡å¹²æ¸‰ã—ã¾ã›ã‚“
       - ä¿å­˜å…ˆï¼šlocalStorageï¼ˆç«¯æœ«ãƒ»URLã”ã¨ï¼‰
    */
    (function(){
      const openAuthBtn = document.getElementById('openAuthBtn');
      const logoutBtn   = document.getElementById('logoutBtn');
      const authStatus  = document.getElementById('authStatus');
      const rsvpBtn     = document.getElementById('eventRsvpBtn');
      const rsvpStatus  = document.getElementById('eventRsvpStatus');

      // å¯¾è±¡è¦ç´ ãŒç„¡ã„å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆå®‰å…¨ç­–ï¼‰
      if(!openAuthBtn || !logoutBtn || !authStatus || !rsvpBtn || !rsvpStatus) return;

      const userKey = 'crb.event.user.v1';
      const rsvpKey = 'crb.event.rsvp.v1';

      function getUser(){
        try{ return JSON.parse(localStorage.getItem(userKey) || 'null'); }
        catch{ return null; }
      }
      function setUser(u){ localStorage.setItem(userKey, JSON.stringify(u)); }
      function clearUser(){ localStorage.removeItem(userKey); }

      function updateAuthUI(){
        const user = getUser();
        if(user && user.name){
          authStatus.textContent = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š${user.name}`;
          openAuthBtn.style.display = 'none';
          logoutBtn.style.display = 'inline-flex';
        }else{
          authStatus.textContent = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
          openAuthBtn.style.display = 'inline-flex';
          logoutBtn.style.display = 'none';
        }
      }
      function updateRsvpUI(){
        const joined = localStorage.getItem(rsvpKey) === 'joined';
        rsvpStatus.textContent = joined ? 'å‚åŠ ç™»éŒ²æ¸ˆã¿' : 'æœªç™»éŒ²';
      }

      openAuthBtn.addEventListener('click', () => {
        const name = prompt('è¡¨ç¤ºåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç«¯æœ«å†…ã®ã¿ä¿å­˜ï¼‰');
        if(!name) return;
        setUser({ name: String(name).trim(), at: Date.now() });
        updateAuthUI();
      });

      logoutBtn.addEventListener('click', () => {
        clearUser();
        updateAuthUI();
      });

      rsvpBtn.addEventListener('click', () => {
        const user = getUser();
        if(!user || !user.name){
          alert('å‚åŠ è¨˜éŒ²ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
          return;
        }
        localStorage.setItem(rsvpKey, 'joined');
        updateRsvpUI();
      });

      // åˆæœŸåæ˜ 
      updateAuthUI();
      updateRsvpUI();
    })();

</script>
<dialog id="auth" style="max-width:560px;width:92vw;border:none;border-radius:16px;padding:0;box-shadow:0 20px 60px rgba(0,0,0,.25)">
  <form method="dialog" style="padding:18px 18px 14px">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
      <div style="font-weight:800;font-size:18px">ã‚¤ãƒ™ãƒ³ãƒˆç”¨ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰</div>
      <button class="btn ghost" value="cancel" aria-label="é–‰ã˜ã‚‹" type="submit">é–‰ã˜ã‚‹</button>
    </div>
    <div class="help" style="margin-top:8px">â€» ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ãƒ»URLã”ã¨ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆå­¦å†…ãƒ‡ãƒ¢ç”¨ï¼‰ã€‚</div>

    <div style="margin-top:12px;display:grid;gap:10px">
      <label class="field">
        <div class="label">ãƒ­ã‚°ã‚¤ãƒ³ID</div>
        <input class="input" id="auth_id" autocomplete="username" placeholder="ä¾‹ï¼šm23m206" />
      </label>
      <label class="field">
        <div class="label">è¡¨ç¤ºåï¼ˆæ–°è¦ç™»éŒ²æ™‚ï¼‰</div>
        <input class="input" id="auth_name" autocomplete="nickname" placeholder="ä¾‹ï¼šå²¡ç†å¤§ å¤ªéƒ" />
      </label>
      <label class="field">
        <div class="label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</div>
        <input class="input" id="auth_pw" type="password" autocomplete="current-password" placeholder="8æ–‡å­—ä»¥ä¸Šæ¨å¥¨" />
      </label>
      <label class="field">
        <div class="label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèª / æ–°è¦ç™»éŒ²æ™‚ï¼‰</div>
        <input class="input" id="auth_pw2" type="password" autocomplete="new-password" placeholder="ç¢ºèªç”¨" />
      </label>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
      <button class="btn primary" type="button" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <button class="btn" type="button" id="registerBtn">æ–°è¦ç™»éŒ²</button>
      <button class="btn ghost" type="button" id="forgetAuthBtn">ç«¯æœ«ã®ç™»éŒ²æƒ…å ±ã‚’å‰Šé™¤</button>
    </div>

    <div class="help" id="authMsg" style="margin-top:10px;color:#b91c1c"></div>
  </form>
</dialog>

</body>
</html>
